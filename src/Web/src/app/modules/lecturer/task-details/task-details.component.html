<div class="container-fluid task-detail-container">
  @if (fetchLoading) {
    <div class="d-flex justify-content-center align-items-center task-loading-container">
      <div class="spinner-border" role="status">
      </div>
    </div>
  } @else {
    <div class="task-container flex-column">
      <div class="task-head-container">
        <h2>
          {{ task.title }}
        </h2>
        <hr>
        <button type="button" class="btn btn-outline-danger"
                (click)="removeTask()"
                [disabled]="removeLoading">
          <span *ngIf="removeLoading" class="spinner-border spinner-border-sm me-1"></span>
          Remove
        </button>
      </div>
      <hr>
      <div class="mt-4">
        <div class="row">
          <div class="col-md-9" style="border-right: 1px solid #ccc; padding-right: 5%">
            <div class="task-description-container">
              <h5>Description</h5>
              <p>{{ task.description }}</p>
              <div class="d-flex justify-content-between text-secondary">
                <p>Assigned at:{{ dateTimeService.convertDateToReadableFormat(task.createdAt) }}</p>
                <p>Due to: {{ dateTimeService.convertDateToReadableFormat(task.deadline) }}</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="additional-info-container text-secondary">
              <p>Group: {{ task.groupName }}</p>
              <p>Turned in: {{ getTurnedInCount() }}</p>
              <p>Returned: {{ getReturnedCount() }}</p>
              <p>Graded: {{ getAcceptedCount() }}</p>
              <p class="text-primary">{{ task.maxGrade }} points</p>
            </div>
          </div>
        </div>
      </div>
      <hr>
      <h5>
        Student works
      </h5>
      <table class="table table-striped">
        <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Name</th>
          <th scope="col">Status</th>
          <th scope="col">Grade</th>
          <th scope="col">Uploaded at</th>
          <th scope="col">File</th>
          <th scope="col"></th>
        </tr>
        </thead>
        <tbody>
          @for (studentTask of task.studentTasks;track studentTask.studentTaskId;let i = $index) {
            <tr>
              <th scope="row">{{ i + 1 }}</th>
              <td>{{ studentTask.student.fullName }}</td>
              <td>{{ getStudentTaskStatus(studentTask.status) }}</td>
              <td>{{ studentTask.grade }}
              </td>
              <td>
                {{ studentTask.uploadedAt ? dateTimeService.convertDateToReadableFormat(studentTask.uploadedAt) : '-' }}
              </td>
              <td>
                {{ studentTask.fileUrl ? studentTask.fileUrl : '-' }}
              </td>
              <td [width]="40">
                <div ngbDropdown container="body">
                  <button type="button" class="btn btn-outline-secondary" ngbDropdownToggle>
                    Actions
                  </button>
                  <div ngbDropdownMenu>
                    <button ngbDropdownItem (click)="openConfirmationModal()">
                      Accept
                    </button>
                    <button ngbDropdownItem (click)="openConfirmationModal()">
                      Return
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
